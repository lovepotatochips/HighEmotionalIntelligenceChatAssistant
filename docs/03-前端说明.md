# 高情商聊天助手 - 前端技术说明文档

## 项目概述

### 技术栈
- **框架**：Vue 3.0
- **UI组件库**：Element Plus
- **构建工具**：Vite 5.4
- **状态管理**：Pinia
- **路由**：Vue Router 4.x
- **HTTP客户端**：Axios
- **语言**：JavaScript

### 项目特点
- 响应式设计，支持移动端和PC端
- 组件化开发，代码复用性高
- 性能优化，加载速度快
- 用户体验友好，交互流畅

## 项目结构

```
frontend/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口
│   │   ├── request.js    # 请求封装
│   │   ├── user.js       # 用户相关API
│   │   ├── script.js     # 话术相关API
│   │   ├── chat.js       # 对话相关API
│   │   └── system.js     # 系统相关API
│   ├── assets/            # 资源文件
│   │   ├── images/       # 图片
│   │   └── styles/       # 样式
│   ├── components/         # 公共组件
│   ├── router/            # 路由配置
│   │   └── index.js
│   ├── stores/            # 状态管理
│   │   └── user.js      # 用户状态
│   ├── views/             # 页面组件
│   │   ├── Login.vue     # 登录页面
│   │   ├── Home.vue      # 首页
│   │   ├── Chat.vue      # 对话页面
│   │   ├── Scripts.vue   # 话术页面
│   │   ├── Favorites.vue # 收藏页面
│   │   └── Profile.vue   # 个人中心
│   ├── App.vue           # 根组件
│   └── main.js           # 入口文件
├── index.html            # HTML模板
├── vite.config.js        # Vite配置
├── package.json          # 项目依赖
└── .env                 # 环境变量
```

## 核心功能模块

### 1. 认证模块

#### 功能描述
处理用户注册、登录、登出等认证相关功能。

#### 主要组件
- **Login.vue**：登录和注册页面
- **user.js Store**：用户状态管理

#### 技术实现
```javascript
// 用户状态管理 (stores/user.js)
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', () => {
  const token = ref(localStorage.getItem('token') || '')
  const userInfo = ref(null)
  
  const isLoggedIn = computed(() => !!token.value)
  
  function setToken(newToken) {
    token.value = newToken
    if (newToken) {
      localStorage.setItem('token', newToken)
    } else {
      localStorage.removeItem('token')
    }
  }
  
  async function login(username, password) {
    const formData = new FormData()
    formData.append('username', username)
    formData.append('password', password)
    
    const response = await loginApi(formData)
    setToken(response.access_token)
    setUserInfo(response.user)
    return response
  }
  
  function logout() {
    setToken('')
    setUserInfo(null)
  }
  
  return {
    token,
    userInfo,
    isLoggedIn,
    login,
    logout
  }
})
```

#### API接口
```javascript
// API调用 (api/user.js)
import request from './request'

export function login(formData) {
  return request({
    url: '/auth/login',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    }
  })
}

export function register(data) {
  return request({
    url: '/auth/register',
    method: 'post',
    data
  })
}
```

### 2. 对话模块

#### 功能描述
实现AI智能对话功能，提供话术生成和调整服务。

#### 主要组件
- **Chat.vue**：对话主页面
- **Message组件**：消息显示组件
- **ScriptCard组件**：话术卡片组件

#### 核心功能
```javascript
// 对话功能实现 (views/Chat.vue)
<script setup>
import { ref, reactive } from 'vue'
import { sendMessage } from '@/api/chat'

const messages = ref([])
const loading = ref(false)
const userInput = ref('')

const handleSend = async () => {
  if (!userInput.value.trim()) return
  
  const userMessage = {
    role: 'user',
    content: userInput.value,
    timestamp: new Date()
  }
  messages.value.push(userMessage)
  
  loading.value = true
  try {
    const response = await sendMessage({
      message: userInput.value,
      session_id: getSessionId()
    })
    
    const aiMessage = {
      role: 'assistant',
      content: response.reply,
      scripts: response.scripts,
      timestamp: new Date()
    }
    messages.value.push(aiMessage)
  } catch (error) {
    ElMessage.error('发送失败，请重试')
  } finally {
    loading.value = false
    userInput.value = ''
  }
}
</script>
```

#### 用户体验优化
- 消息自动滚动到底部
- 加载状态提示
- 错误处理和重试机制
- 对话历史保存

### 3. 话术库模块

#### 功能描述
提供话术浏览、搜索、筛选功能。

#### 主要组件
- **Scripts.vue**：话术库主页面
- **ScriptDetail.vue**：话术详情页面
- **FilterPanel组件**：筛选面板

#### 核心功能
```javascript
// 话术搜索实现 (views/Scripts.vue)
<script setup>
import { ref, onMounted } from 'vue'
import { searchScripts } from '@/api/script'

const scripts = ref([])
const searchForm = reactive({
  keyword: '',
  position_id: null,
  category_id: null,
  tone: '',
  page: 1,
  page_size: 10
})

const handleSearch = async () => {
  try {
    const response = await searchScripts(searchForm)
    scripts.value = response.scripts
  } catch (error) {
    ElMessage.error('搜索失败')
  }
}

onMounted(() => {
  handleSearch()
})
</script>
```

#### 功能特性
- 多条件组合搜索
- 分页加载
- 实时搜索反馈
- 搜索历史记录

### 4. 收藏管理模块

#### 功能描述
管理用户收藏的话术，支持收藏、编辑、删除等操作。

#### 主要组件
- **Favorites.vue**：收藏管理页面
- **FavoriteCard组件**：收藏卡片组件

#### 核心功能
```javascript
// 收藏管理实现 (views/Favorites.vue)
<script setup>
import { ref, onMounted } from 'vue'
import { getFavorites, addFavorite, removeFavorite } from '@/api/script'

const favorites = ref([])

const loadFavorites = async () => {
  try {
    const response = await getFavorites()
    favorites.value = response
  } catch (error) {
    ElMessage.error('加载收藏失败')
  }
}

const handleAddFavorite = async (scriptId) => {
  try {
    await addFavorite(scriptId)
    ElMessage.success('收藏成功')
    await loadFavorites()
  } catch (error) {
    ElMessage.error('收藏失败')
  }
}

const handleRemoveFavorite = async (scriptId) => {
  try {
    await removeFavorite(scriptId)
    ElMessage.success('取消收藏成功')
    await loadFavorites()
  } catch (error) {
    ElMessage.error('操作失败')
  }
}

onMounted(() => {
  loadFavorites()
})
</script>
```

#### 功能特性
- 收藏分类管理
- 批量操作
- 收藏导出
- 收藏统计

### 5. 个人中心模块

#### 功能描述
用户个人信息管理和设置。

#### 主要组件
- **Profile.vue**：个人中心页面
- **Settings组件**：设置组件
- **AvatarUpload组件**：头像上传组件

#### 核心功能
```javascript
// 个人设置实现 (views/Profile.vue)
<script setup>
import { ref, reactive } from 'vue'
import { getUserInfo, updateUser } from '@/api/user'
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
const profileForm = reactive({
  username: '',
  phone: '',
  email: '',
  role: '',
  avatar_url: '',
  tone_preference: '温和',
  length_preference: '简洁版'
})

const loadProfile = async () => {
  try {
    const response = await getUserInfo()
    Object.assign(profileForm, response)
  } catch (error) {
    ElMessage.error('加载个人信息失败')
  }
}

const handleSave = async () => {
  try {
    await updateUser(profileForm)
    ElMessage.success('保存成功')
  } catch (error) {
    ElMessage.error('保存失败')
  }
}

onMounted(() => {
  loadProfile()
})
</script>
```

#### 功能特性
- 个人信息编辑
- 头像上传
- 偏好设置
- 安全设置

## 技术实现细节

### 1. 请求封装

#### 拦截器配置
```javascript
// 请求拦截器
request.interceptors.request.use(
  config => {
    const userStore = useUserStore()
    if (userStore.token) {
      config.headers.Authorization = `Bearer ${userStore.token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  response => {
    return response.data
  },
  error => {
    if (error.response) {
      const { status, data } = error.response
      
      if (status === 401) {
        const userStore = useUserStore()
        userStore.logout()
        router.push('/login')
        ElMessage.error('登录已过期，请重新登录')
      } else if (status === 403) {
        ElMessage.error('没有权限访问')
      } else if (status === 404) {
        ElMessage.error('请求的资源不存在')
      } else if (status === 500) {
        ElMessage.error('服务器错误，请稍后重试')
      } else {
        ElMessage.error(data.detail || '请求失败')
      }
    } else {
      ElMessage.error('网络错误，请检查网络连接')
    }
    
    return Promise.reject(error)
  }
)
```

#### 特性说明
- 自动添加认证token
- 统一错误处理
- 请求超时设置
- 响应数据格式化

### 2. 路由配置

#### 路由守卫
```javascript
// 路由守卫 (router/index.js)
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()
  
  if (to.meta.requiresAuth && !userStore.isLoggedIn) {
    next('/login')
  } else if (to.path === '/login' && userStore.isLoggedIn) {
    next('/')
  } else {
    next()
  }
})
```

#### 路由配置
```javascript
const routes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/Login.vue')
  },
  {
    path: '/',
    component: () => import('@/views/Home.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/chat',
    component: () => import('@/views/Chat.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/scripts',
    component: () => import('@/views/Scripts.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/favorites',
    component: () => import('@/views/Favorites.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/profile',
    component: () => import('@/views/Profile.vue'),
    meta: { requiresAuth: true }
  }
]
```

### 3. 状态管理

#### 用户状态
```javascript
// stores/user.js
export const useUserStore = defineStore('user', () => {
  const token = ref(localStorage.getItem('token') || '')
  const userInfo = ref(null)
  
  const isLoggedIn = computed(() => !!token.value)
  
  function setToken(newToken) {
    token.value = newToken
    if (newToken) {
      localStorage.setItem('token', newToken)
    } else {
      localStorage.removeItem('token')
    }
  }
  
  function setUserInfo(info) {
    userInfo.value = info
  }
  
  async function login(username, password) {
    const formData = new FormData()
    formData.append('username', username)
    formData.append('password', password)
    
    const response = await loginApi(formData)
    setToken(response.access_token)
    setUserInfo(response.user)
    return response
  }
  
  async function register(userData) {
    const response = await registerApi(userData)
    return response
  }
  
  async function fetchUserInfo() {
    const response = await getUserInfo()
    setUserInfo(response)
    return response
  }
  
  function logout() {
    setToken('')
    setUserInfo(null)
  }
  
  return {
    token,
    userInfo,
    isLoggedIn,
    login,
    register,
    fetchUserInfo,
    logout
  }
})
```

### 4. 组件开发

#### 公共组件
- **BaseLayout**：基础布局组件
- **PageHeader**：页面头部组件
- **Loading**：加载组件
- **Empty**：空状态组件

#### 业务组件
- **ChatMessage**：聊天消息组件
- **ScriptCard**：话术卡片组件
- **FilterPanel**：筛选面板组件
- **UserAvatar**：用户头像组件

## 样式设计

### 设计规范

#### 色彩系统
```scss
// 主色调
$primary-color: #409EFF;
$success-color: #67C23A;
$warning-color: #E6A23C;
$danger-color: #F56C6C;
$info-color: #909399;

// 中性色
$text-primary: #303133;
$text-regular: #606266;
$text-secondary: #909399;
$text-placeholder: #C0C4CC;

// 背景色
$bg-color: #F5F7FA;
$bg-color-page: #FFFFFF;
```

#### 字体规范
```scss
// 字体大小
$font-size-large: 18px;
$font-size-medium: 16px;
$font-size-base: 14px;
$font-size-small: 12px;

// 行高
$line-height-base: 1.5;
$line-height-small: 1.2;
```

#### 间距规范
```scss
// 间距单位
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;
```

### 响应式设计

#### 断点设置
```scss
// 移动端优先
$breakpoint-mobile: 375px;
$breakpoint-tablet: 768px;
$breakpoint-desktop: 1024px;
$breakpoint-large: 1440px;

// 响应式混合
@mixin mobile {
  @media (max-width: $breakpoint-mobile) {
    @content;
  }
}

@mixin tablet {
  @media (min-width: $breakpoint-tablet) {
    @content;
  }
}

@mixin desktop {
  @media (min-width: $breakpoint-desktop) {
    @content;
  }
}
```

## 性能优化

### 1. 代码分割

#### 路由懒加载
```javascript
const routes = [
  {
    path: '/chat',
    component: () => import('@/views/Chat.vue')
  }
]
```

#### 组件懒加载
```javascript
const HeavyComponent = defineAsyncComponent(() => 
  import('@/components/HeavyComponent.vue')
)
```

### 2. 资源优化

#### 图片优化
- 使用WebP格式
- 压缩图片大小
- 懒加载图片
- CDN加速

#### 代码压缩
- Vite自动压缩代码
- 去除console日志
- Tree Shaking

### 3. 缓存策略

#### HTTP缓存
```javascript
// 设置缓存头
headers: {
  'Cache-Control': 'max-age=3600'
}
```

#### 本地缓存
```javascript
// 使用localStorage缓存数据
const cacheData = (key, data, expire = 3600) => {
  const cache = {
    data,
    expire: Date.now() + expire * 1000
  }
  localStorage.setItem(key, JSON.stringify(cache))
}

const getCachedData = (key) => {
  const cache = JSON.parse(localStorage.getItem(key))
  if (!cache) return null
  
  if (Date.now() > cache.expire) {
    localStorage.removeItem(key)
    return null
  }
  
  return cache.data
}
```

## 构建与部署

### 开发环境

#### 启动开发服务器
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

#### 开发服务器配置
```javascript
// vite.config.js
export default defineConfig({
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  }
})
```

### 生产环境

#### 构建生产版本
```bash
# 构建生产版本
npm run build

# 预览生产构建
npm run preview
```

#### 构建配置
```javascript
// vite.config.js
export default defineConfig({
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus'],
          'utils': ['axios']
        }
      }
    }
  }
})
```

### 部署方案

#### 静态部署
```bash
# 构建项目
npm run build

# 部署到服务器
scp -r dist/* user@server:/var/www/html/
```

#### Nginx配置
```nginx
server {
  listen 80;
  server_name example.com;
  
  root /var/www/html;
  index index.html;
  
  location / {
    try_files $uri $uri/ /index.html;
  }
  
  location /api {
    proxy_pass http://localhost:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
  
  # 静态资源缓存
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
  }
}
```

#### Docker部署
```dockerfile
# Dockerfile
FROM node:18-alpine as build-stage
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine as production-stage
COPY --from=build-stage /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

```yaml
# docker-compose.yml
version: '3'
services:
  frontend:
    build: .
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
```

## 开发指南

### 代码规范

#### 命名规范
- 组件名：PascalCase (UserProfile)
- 文件名：kebab-case (user-profile.vue)
- 变量名：camelCase (userName)
- 常量名：UPPER_SNAKE_CASE (API_BASE_URL)

#### 代码格式
```vue
<template>
  <div class="container">
    <h1>{{ title }}</h1>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const title = ref('Hello World')
</script>

<style lang="scss" scoped>
.container {
  padding: 16px;
}
</style>
```

### Git工作流

#### 分支策略
- `main`：主分支，用于生产环境
- `develop`：开发分支，用于集成新功能
- `feature/*`：功能分支
- `hotfix/*`：紧急修复分支

#### 提交规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
test: 测试相关
chore: 构建/工具链相关
```

### 调试技巧

#### Vue DevTools
- 安装Vue DevTools浏览器插件
- 查看组件状态和props
- 调试Vuex/Pinia状态
- 性能分析

#### 网络调试
- 使用浏览器开发者工具
- 查看网络请求
- 检查请求和响应
- 分析性能瓶颈

## 常见问题

### Q1：如何添加新的页面？
A：在`views`目录下创建新的Vue组件，然后在`router/index.js`中添加路由配置。

### Q2：如何自定义Element Plus主题？
A：在`styles/theme.scss`中覆盖Element Plus的样式变量，然后在main.js中引入。

### Q3：如何处理跨域问题？
A：在`vite.config.js`中配置proxy，将API请求代理到后端服务器。

### Q4：如何优化首屏加载速度？
A：使用路由懒加载、代码分割、资源压缩等技术来优化加载性能。

## 更新日志

### v1.0.0 (2024-02-16)
- 初始版本发布
- 实现基础功能模块
- 完成UI设计
- 性能优化

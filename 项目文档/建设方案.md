# 建设方案

## 文档信息

| 项目名称 | VibeCoding高情商聊天助手 |
|---------|----------------------|
| 文档版本 | V1.0 |
| 编写日期 | 2026-02-18 |
| 文档类型 | 建设方案 |

## 目录

1. [项目概述](#1-项目概述)
2. [技术架构](#2-技术架构)
3. [系统设计](#3-系统设计)
4. [数据库设计](#4-数据库设计)
5. [接口设计](#5-接口设计)
6. [安全设计](#6-安全设计)
7. [性能设计](#7-性能设计)
8. [部署方案](#8-部署方案)
9. [开发规范](#9-开发规范)
10. [测试方案](#10-测试方案)

---

## 1. 项目概述

### 1.1 项目背景

移动端软件研发项目团队在沟通协作中普遍存在沟通效率低、沟通质量差的问题。为解决这一痛点，本项目开发了一款智能话术助手应用，通过AI技术和岗位专属话术库，帮助团队成员提升沟通效率和职场情商。

### 1.2 项目目标

- 构建一个覆盖研发全岗位的智能话术助手系统
- 提供基于AI的智能对话功能，实现话术的智能推荐
- 建立完善的话术管理体系，支持多维度搜索和筛选
- 实现话术的个性化调整和收藏功能
- 提供易用的Web界面，提升用户体验

### 1.3 建设原则

- **用户导向**：以用户需求为中心，提供易用、高效的功能
- **技术先进**：采用主流技术栈，保证系统的先进性和可维护性
- **安全可靠**：确保系统安全稳定，保护用户数据安全
- **可扩展性**：采用模块化设计，便于后续功能扩展
- **高性能**：优化系统性能，保证良好的用户体验

---

## 2. 技术架构

### 2.1 整体架构

系统采用前后端分离架构，分为前端展示层、后端服务层、数据存储层。

```
┌─────────────────────────────────────────────────┐
│                  用户浏览器                      │
└──────────────────┬──────────────────────────────┘
                   │ HTTPS/HTTP
                   ▼
┌─────────────────────────────────────────────────┐
│               前端应用 (Vue 3)                │
│  - 用户界面展示                                │
│  - 用户交互处理                                │
│  - 状态管理 (Pinia)                           │
│  - 路由管理 (Vue Router)                      │
└──────────────────┬──────────────────────────────┘
                   │ RESTful API
                   ▼
┌─────────────────────────────────────────────────┐
│              后端服务 (FastAPI)                │
│  - API路由层                                   │
│  - 业务逻辑层                                   │
│  - AI服务层                                    │
│  - 认证授权层                                  │
└──────────────────┬──────────────────────────────┘
                   │ ORM
                   ▼
┌─────────────────────────────────────────────────┐
│              数据存储层                         │
│  - SQLite (开发环境)                           │
│  - MySQL (生产环境)                            │
└─────────────────────────────────────────────────┘
```

### 2.2 技术选型

#### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.x | 渐进式JavaScript框架 |
| Element Plus | 2.x | UI组件库 |
| Vite | 5.x | 构建工具 |
| Vue Router | 4.x | 路由管理 |
| Pinia | 2.x | 状态管理 |
| Axios | 1.x | HTTP客户端 |
| Day.js | 1.x | 日期处理 |

#### 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Python | 3.8+ | 编程语言 |
| FastAPI | 0.115+ | Web框架 |
| SQLAlchemy | 2.0+ | ORM框架 |
| Pydantic | 2.10+ | 数据验证 |
| Pydantic Settings | 2.6+ | 配置管理 |
| PyMySQL | 1.1+ | MySQL驱动 |
| Python-Jose | 3.3+ | JWT认证 |
| PassLib + Bcrypt | 1.7+ | 密码加密 |
| Uvicorn | 0.32+ | ASGI服务器 |

#### 数据库

| 数据库 | 用途 | 说明 |
|--------|------|------|
| SQLite | 开发环境 | 轻量级数据库，开箱即用 |
| MySQL 5.7+ | 生产环境 | 关系型数据库，适合生产环境 |

### 2.3 架构优势

- **前后端分离**：前后端独立开发和部署，提升开发效率
- **模块化设计**：各模块职责清晰，便于维护和扩展
- **异步处理**：FastAPI支持异步处理，提升系统性能
- **ORM框架**：使用SQLAlchemy进行数据库操作，提高开发效率
- **类型安全**：使用Pydantic进行数据验证，保证数据安全性

---

## 3. 系统设计

### 3.1 系统模块划分

系统分为7大功能模块：

| 模块 | 功能 | 子模块 |
|------|------|--------|
| 用户管理模块 | 用户注册、登录、信息管理 | 用户认证、用户信息管理 |
| AI对话模块 | 智能对话、场景识别、岗位识别 | 意图识别、场景匹配、话术推荐 |
| 话术管理模块 | 话术搜索、详情查看、点赞 | 搜索服务、详情服务、统计服务 |
| 话术调整模块 | 语气调整、长度调整 | 调整服务 |
| 收藏管理模块 | 收藏添加、取消、列表查看 | 收藏服务 |
| 对话历史模块 | 对话记录保存、查询 | 历史服务 |
| 系统配置模块 | 系统参数配置 | 配置服务 |

### 3.2 核心业务流程

#### 用户注册流程

```
用户填写注册信息
      ↓
前端表单验证
      ↓
发送注册请求到后端
      ↓
后端验证用户名唯一性
      ↓
验证手机号唯一性（如填写）
      ↓
密码加密（Bcrypt）
      ↓
保存用户信息到数据库
      ↓
返回注册成功和用户信息
```

#### 用户登录流程

```
用户输入用户名和密码
      ↓
前端表单验证
      ↓
发送登录请求到后端
      ↓
后端查询用户信息
      ↓
验证密码（Bcrypt）
      ↓
检查账户状态（是否激活）
      ↓
生成JWT令牌
      ↓
返回令牌和用户信息
      ↓
前端保存令牌到本地存储
      ↓
跳转到首页
```

#### AI对话流程

```
用户输入消息
      ↓
发送消息到后端
      ↓
AI服务识别意图
      ↓
AI服务识别场景
      ↓
AI服务识别岗位
      ↓
提取关键词
      ↓
搜索匹配话术
      ↓
生成回复和推荐话术列表
      ↓
保存对话记录
      ↓
返回AI回复和话术列表
      ↓
前端展示回复和话术卡片
```

#### 话术搜索流程

```
用户设置搜索条件
      ↓
发送搜索请求到后端
      ↓
后端构建查询条件
      ↓
数据库查询（支持多条件筛选）
      ↓
排序（按使用次数降序）
      ↓
分页处理
      ↓
返回搜索结果
      ↓
前端展示话术列表
```

### 3.3 前端页面设计

#### 页面列表

| 页面 | 路径 | 功能 |
|------|------|------|
| 登录页 | /login | 用户登录/注册 |
| 首页 | / | 快捷功能入口、常见场景 |
| AI对话页 | /chat | AI智能对话 |
| 话术库页 | /scripts | 话术搜索和浏览 |
| 收藏页 | /favorites | 收藏管理 |
| 个人中心页 | /profile | 个人信息管理 |

#### 页面跳转关系

```
登录页 → 首页
         ↓
    ├─→ AI对话页
    ├─→ 话术库页
    ├─→ 收藏页
    └─→ 个人中心页

所有页面 → 返回上一页 / 首页
```

---

## 4. 数据库设计

### 4.1 数据库选型

| 数据库 | 优点 | 缺点 | 适用场景 |
|--------|------|------|---------|
| SQLite | 轻量级、无需安装、开箱即用 | 不适合高并发、不支持远程访问 | 开发环境、小型项目 |
| MySQL | 性能好、支持高并发、功能完善 | 需要独立安装配置 | 生产环境、中大型项目 |

### 4.2 数据表设计

#### 用户表 (users)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 用户ID | PRIMARY KEY, AUTO_INCREMENT |
| username | VARCHAR(50) | 用户名 | UNIQUE, NOT NULL |
| password_hash | VARCHAR(255) | 密码哈希 | NOT NULL |
| phone | VARCHAR(20) | 手机号 | UNIQUE |
| email | VARCHAR(100) | 邮箱 | |
| role | VARCHAR(20) | 角色 | NOT NULL, DEFAULT 'user' |
| avatar_url | VARCHAR(255) | 头像URL | |
| is_active | TINYINT(1) | 是否激活 | DEFAULT 1 |
| is_vip | TINYINT(1) | 是否VIP | DEFAULT 0 |
| vip_expire_time | DATETIME | VIP过期时间 | |
| tone_preference | VARCHAR(20) | 语气偏好 | DEFAULT '温和' |
| length_preference | VARCHAR(20) | 长度偏好 | DEFAULT '简洁版' |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updated_at | TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |

**索引**：
- idx_username (username)
- idx_phone (phone)
- idx_role (role)

#### 岗位表 (positions)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 岗位ID | PRIMARY KEY, AUTO_INCREMENT |
| name | VARCHAR(50) | 岗位名称 | NOT NULL |
| code | VARCHAR(20) | 岗位代码 | UNIQUE, NOT NULL |
| description | VARCHAR(200) | 岗位描述 | |
| sort_order | INT | 排序 | DEFAULT 0 |
| is_active | TINYINT(1) | 是否启用 | DEFAULT 1 |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

#### 话术分类表 (script_categories)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 分类ID | PRIMARY KEY, AUTO_INCREMENT |
| name | VARCHAR(50) | 分类名称 | NOT NULL |
| code | VARCHAR(50) | 分类代码 | UNIQUE, NOT NULL |
| parent_id | INT | 父分类ID | DEFAULT 0 |
| position_id | INT | 关联岗位ID | |
| description | VARCHAR(200) | 分类描述 | |
| icon | VARCHAR(100) | 图标 | |
| sort_order | INT | 排序 | DEFAULT 0 |
| is_active | TINYINT(1) | 是否启用 | DEFAULT 1 |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

**索引**：
- idx_position_id (position_id)
- idx_parent_id (parent_id)

#### 话术表 (scripts)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 话术ID | PRIMARY KEY, AUTO_INCREMENT |
| title | VARCHAR(100) | 话术标题 | NOT NULL |
| content | TEXT | 话术内容 | NOT NULL |
| brief_content | TEXT | 简洁版内容 | |
| category_id | INT | 分类ID | NOT NULL |
| position_id | INT | 岗位ID | |
| scene_type | VARCHAR(50) | 场景类型 | NOT NULL |
| tone | VARCHAR(20) | 语气 | DEFAULT '温和' |
| target_audience | VARCHAR(50) | 目标对象 | |
| tags | VARCHAR(200) | 标签 | |
| usage_count | INT | 使用次数 | DEFAULT 0 |
| like_count | INT | 点赞次数 | DEFAULT 0 |
| is_free | TINYINT(1) | 是否免费 | DEFAULT 1 |
| is_active | TINYINT(1) | 是否启用 | DEFAULT 1 |
| created_by | BIGINT | 创建者ID | |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updated_at | TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |

**索引**：
- idx_category_id (category_id)
- idx_position_id (position_id)
- idx_scene_type (scene_type)
- idx_tags (tags(100))
- idx_content (title, content) FULLTEXT

#### 用户收藏表 (user_favorites)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 收藏ID | PRIMARY KEY, AUTO_INCREMENT |
| user_id | BIGINT | 用户ID | NOT NULL |
| script_id | BIGINT | 话术ID | NOT NULL |
| custom_content | TEXT | 自定义内容 | |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

**索引**：
- uk_user_script (user_id, script_id) UNIQUE
- idx_user_id (user_id)
- idx_script_id (script_id)

#### 对话记录表 (conversations)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 对话ID | PRIMARY KEY, AUTO_INCREMENT |
| user_id | BIGINT | 用户ID | NOT NULL |
| session_id | VARCHAR(64) | 会话ID | NOT NULL |
| message_type | VARCHAR(20) | 消息类型 | NOT NULL |
| content | TEXT | 消息内容 | NOT NULL |
| context_data | JSON | 上下文数据 | |
| intent | VARCHAR(50) | 意图 | |
| referenced_script_id | BIGINT | 关联话术ID | |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

**索引**：
- idx_user_id (user_id)
- idx_session_id (session_id)
- idx_created_at (created_at)

#### 话术调整记录表 (script_adjustments)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 调整ID | PRIMARY KEY, AUTO_INCREMENT |
| user_id | BIGINT | 用户ID | NOT NULL |
| script_id | BIGINT | 话术ID | NOT NULL |
| original_content | TEXT | 原始内容 | |
| adjusted_content | TEXT | 调整后内容 | |
| tone | VARCHAR(20) | 语气 | |
| length_type | VARCHAR(20) | 长度类型 | |
| feedback | VARCHAR(200) | 用户反馈 | |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

**索引**：
- idx_user_id (user_id)
- idx_script_id (script_id)

#### 系统配置表 (system_configs)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INT | 配置ID | PRIMARY KEY, AUTO_INCREMENT |
| config_key | VARCHAR(100) | 配置键 | UNIQUE, NOT NULL |
| config_value | TEXT | 配置值 | |
| description | VARCHAR(200) | 配置描述 | |
| created_at | TIMESTAMP | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updated_at | TIMESTAMP | 更新时间 | ON UPDATE CURRENT_TIMESTAMP |

### 4.3 ER图

```
users (用户)
    ├─1:N─→ user_favorites (用户收藏)
    ├─1:N─→ conversations (对话记录)
    └─1:N─→ script_adjustments (调整记录)

positions (岗位)
    └─1:N─→ script_categories (话术分类)
           └─1:N─→ scripts (话术)

script_categories (话术分类)
    └─1:N─→ scripts (话术)

scripts (话术)
    ├─1:N─→ user_favorites (用户收藏)
    └─1:N─→ script_adjustments (调整记录)

system_configs (系统配置)
```

---

## 5. 接口设计

### 5.1 接口设计原则

- **RESTful风格**：遵循RESTful API设计规范
- **统一响应格式**：使用统一的JSON响应格式
- **版本控制**：通过URL路径进行版本控制
- **错误处理**：统一的错误码和错误信息
- **认证授权**：使用JWT进行身份认证

### 5.2 统一响应格式

#### 成功响应

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

#### 错误响应

```json
{
  "code": 400,
  "message": "错误描述",
  "detail": "详细错误信息"
}
```

### 5.3 接口列表

详见《后端接口说明书》。

---

## 6. 安全设计

### 6.1 认证安全

- **密码加密**：使用Bcrypt算法加密存储密码
- **JWT令牌**：使用JWT进行身份认证
- **令牌有效期**：默认7天
- **令牌刷新**：支持令牌刷新（后续版本）

### 6.2 数据安全

- **SQL注入防护**：使用ORM框架，防止SQL注入
- **XSS防护**：前端对用户输入进行转义
- **CSRF防护**：使用SameSite Cookie策略
- **敏感数据加密**：密码等敏感数据加密存储

### 6.3 传输安全

- **HTTPS**：生产环境使用HTTPS协议
- **数据加密**：敏感数据传输加密

### 6.4 接口安全

- **CORS配置**：合理配置CORS白名单
- **请求限流**：防止恶意请求
- **参数验证**：使用Pydantic进行参数验证

---

## 7. 性能设计

### 7.1 数据库优化

- **索引优化**：为常用查询字段添加索引
- **查询优化**：优化SQL查询语句
- **分页查询**：大数据量使用分页查询
- **连接池**：使用数据库连接池

### 7.2 缓存策略

- **话术缓存**：热门话术缓存到内存
- **分类缓存**：话术分类缓存
- **岗位缓存**：岗位信息缓存

### 7.3 前端优化

- **代码分割**：使用路由懒加载
- **资源压缩**：Gzip压缩
- **CDN加速**：静态资源使用CDN

---

## 8. 部署方案

### 8.1 开发环境部署

#### 环境要求

- Python 3.8+
- Node.js 16+
- SQLite

#### 部署步骤

1. 克隆代码仓库
2. 安装后端依赖
3. 配置环境变量
4. 启动后端服务
5. 安装前端依赖
6. 启动前端开发服务器

### 8.2 生产环境部署

#### 环境要求

- Python 3.8+
- Node.js 16+
- MySQL 5.7+
- Nginx

#### 部署架构

```
Internet
    ↓
[Nginx]
    ↓ ├─→ [前端静态资源]
    └─→ [后端API服务]
           ↓
       [MySQL数据库]
```

#### 部署步骤

1. **数据库部署**
   - 安装MySQL
   - 创建数据库
   - 执行初始化脚本

2. **后端部署**
   - 安装Python依赖
   - 配置环境变量（使用MySQL）
   - 使用Gunicorn + Uvicorn启动
   - 配置反向代理

3. **前端部署**
   - 构建生产版本
   - 部署静态资源
   - 配置Nginx

4. **HTTPS配置**
   - 申请SSL证书
   - 配置HTTPS

### 8.3 Docker部署（可选）

#### Dockerfile示例

```dockerfile
# 后端Dockerfile
FROM python:3.8-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

```dockerfile
# 前端Dockerfile
FROM node:16-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
```

---

## 9. 开发规范

### 9.1 后端开发规范

#### 代码风格

- 遵循PEP 8代码风格
- 使用类型注解（Type Hints）
- 函数和类添加文档字符串

#### 命名规范

- 文件名：小写+下划线（snake_case）
- 类名：大驼峰（PascalCase）
- 函数/变量名：小写+下划线（snake_case）
- 常量名：大写+下划线（UPPER_CASE）

#### 异常处理

- 所有异常都要捕获并处理
- 返回明确的错误信息
- 记录错误日志

### 9.2 前端开发规范

#### 代码风格

- 使用Vue 3 Composition API
- 遵循Vue官方风格指南
- 使用ESLint进行代码检查

#### 命名规范

- 组件名：大驼峰（PascalCase）
- 文件名：大驼峰（PascalCase）
- 变量/函数名：小驼峰（camelCase）
- 常量名：大写+下划线（UPPER_CASE）

#### 组件规范

- 单一职责原则
- Props和Emits明确声明
- 使用TypeScript（推荐）

---

## 10. 测试方案

### 10.1 测试类型

| 测试类型 | 说明 | 覆盖范围 |
|---------|------|---------|
| 单元测试 | 测试单个函数/方法 | 核心业务逻辑 |
| 集成测试 | 测试模块间交互 | API接口 |
| 端到端测试 | 测试完整业务流程 | 主要用户场景 |
| 性能测试 | 测试系统性能 | 高并发场景 |

### 10.2 测试工具

- 后端：pytest
- 前端：Vitest + Vue Test Utils
- E2E：Playwright

### 10.3 测试计划

#### 单元测试

- AI服务逻辑测试
- 工具函数测试
- 业务逻辑测试

#### 集成测试

- API接口测试
- 数据库操作测试
- 认证授权测试

#### 端到端测试

- 用户注册/登录流程
- AI对话流程
- 话术搜索流程
- 收藏管理流程

---

**文档结束**
